<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIæµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { 
            background: #f8fafc; 
            padding: 20px; 
            border-radius: 8px; 
            margin: 20px 0; 
            border: 1px solid #e2e8f0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px; 
        }
        pre { background: #f1f3f4; padding: 15px; border-radius: 4px; overflow-x: auto; }
        .article { 
            background: white; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border-left: 4px solid #007bff; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ç®€å•APIæµ‹è¯•</h1>
        <p>è¿™ä¸ªé¡µé¢ä½¿ç”¨åŸç”Ÿfetchæµ‹è¯•Supabase APIï¼Œä¸ä¾èµ–å¤–éƒ¨æ¨¡å—</p>
        
        <button onclick="testArticles()">ğŸ“ æµ‹è¯•æ–‡ç« API</button>
        <button onclick="testCategories()">ğŸ“‹ æµ‹è¯•åˆ†ç±»API</button>
        <button onclick="clearResults()">ğŸ§¹ æ¸…ç©ºç»“æœ</button>
        
        <div id="results"></div>
    </div>

    <script>
        const API_URL = 'https://talufbfkwrdrpwbzurcu.supabase.co'
        const API_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRhbHVmYmZrd3JkcnB3Ynp1cmN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNjMxODUsImV4cCI6MjA3ODkzOTE4NX0.tpBu2CSiKJo0Z-YjPcF2Oey8qyhPlinuzJA6Ld8CTo0'

        function showResult(title, data, isSuccess = true) {
            const results = document.getElementById('results')
            const section = document.createElement('div')
            section.className = `test-section ${isSuccess ? 'success' : 'error'}`
            section.innerHTML = `
                <h3>${title}</h3>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `
            results.appendChild(section)
            
            // æ»šåŠ¨åˆ°æœ€æ–°ç»“æœ
            section.scrollIntoView({ behavior: 'smooth' })
        }

        function showArticlePreview(articles) {
            const results = document.getElementById('results')
            
            articles.forEach(article => {
                const preview = document.createElement('div')
                preview.className = 'test-section info article'
                preview.innerHTML = `
                    <h4>ğŸ“„ ${article.title}</h4>
                    <p><strong>åˆ†ç±»:</strong> ${article.categories?.name || 'æœªåˆ†ç±»'}</p>
                    <p><strong>æ‘˜è¦:</strong> ${article.summary || 'æš‚æ— æ‘˜è¦'}</p>
                    <p><strong>åˆ›å»ºæ—¶é—´:</strong> ${article.created_at}</p>
                    <p><strong>é˜…è¯»é‡:</strong> ${article.view_count || 0}</p>
                    <p><strong>å†…å®¹:</strong> ${article.content ? article.content.substring(0, 100) + '...' : 'æš‚æ— å†…å®¹'}</p>
                `
                results.appendChild(preview)
            })
        }

        window.testArticles = async function() {
            console.log('ğŸ”„ å¼€å§‹æµ‹è¯•æ–‡ç« API...')
            
            try {
                const response = await fetch(`${API_URL}/rest/v1/articles?select=*,categories(name)&is_published=eq.true&order=created_at.desc&limit=3`, {
                    method: 'GET',
                    headers: {
                        'apikey': API_KEY,
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                })

                console.log('ğŸ“¡ å“åº”çŠ¶æ€:', response.status)
                console.log('ğŸ“¡ å“åº”å¤´:', response.headers)

                if (!response.ok) {
                    const errorText = await response.text()
                    throw new Error(`HTTP ${response.status}: ${response.statusText} - ${errorText}`)
                }

                const articles = await response.json()
                
                console.log('âœ… è·å–åˆ°çš„æ–‡ç« :', articles)
                
                showResult('âœ… æ–‡ç« APIæµ‹è¯•æˆåŠŸ', {
                    æ–‡ç« æ•°é‡: articles.length,
                    æ•°æ®: articles
                }, true)
                
                // æ˜¾ç¤ºæ–‡ç« é¢„è§ˆ
                if (articles.length > 0) {
                    showArticlePreview(articles)
                } else {
                    showResult('âš ï¸ æ²¡æœ‰æ‰¾åˆ°æ–‡ç« ', 'æ•°æ®åº“ä¸­æ²¡æœ‰å·²å‘å¸ƒçš„æ–‡ç« ', false)
                }

            } catch (error) {
                console.error('âŒ æ–‡ç« APIæµ‹è¯•å¤±è´¥:', error)
                showResult('âŒ æ–‡ç« APIæµ‹è¯•å¤±è´¥', {
                    é”™è¯¯ä¿¡æ¯: error.message,
                    å¯èƒ½åŸå› : [
                        'ç½‘ç»œè¿æ¥é—®é¢˜',
                        'APIå¯†é’¥æ— æ•ˆ',
                        'CORSæƒé™é—®é¢˜',
                        'SupabaseæœåŠ¡å™¨é”™è¯¯'
                    ]
                }, false)
            }
        }

        window.testCategories = async function() {
            console.log('ğŸ”„ å¼€å§‹æµ‹è¯•åˆ†ç±»API...')
            
            try {
                const response = await fetch(`${API_URL}/rest/v1/categories?select=*&order=name`, {
                    method: 'GET',
                    headers: {
                        'apikey': API_KEY,
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                })

                if (!response.ok) {
                    const errorText = await response.text()
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`)
                }

                const categories = await response.json()
                
                console.log('âœ… è·å–åˆ°çš„åˆ†ç±»:', categories)
                
                showResult('âœ… åˆ†ç±»APIæµ‹è¯•æˆåŠŸ', {
                    åˆ†ç±»æ•°é‡: categories.length,
                    æ•°æ®: categories
                }, true)

            } catch (error) {
                console.error('âŒ åˆ†ç±»APIæµ‹è¯•å¤±è´¥:', error)
                showResult('âŒ åˆ†ç±»APIæµ‹è¯•å¤±è´¥', {
                    é”™è¯¯ä¿¡æ¯: error.message
                }, false)
            }
        }

        window.clearResults = function() {
            document.getElementById('results').innerHTML = ''
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•æ–‡ç« API
        window.addEventListener('load', function() {
            console.log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æµ‹è¯•...')
            setTimeout(testArticles, 1000)
        })
    </script>
</body>
</html>