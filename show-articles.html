<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ç« å†…å®¹å±•ç¤º</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 40px; }
        .articles-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        .article-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .article-meta { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .category { background: #e0e7ff; color: #4f46e5; padding: 5px 12px; border-radius: 15px; font-size: 14px; }
        .date { color: #64748b; font-size: 14px; }
        .title { font-size: 1.25rem; color: #1e293b; margin-bottom: 10px; }
        .summary { color: #64748b; margin-bottom: 15px; }
        .views { color: #94a3b8; font-size: 14px; }
        .loading { text-align: center; padding: 40px; color: #64748b; }
        .error { background: #fef2f2; border: 1px solid #fecaca; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; padding: 20px; border-radius: 8px; margin: 20px 0; }
        button { background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š åšå®¢æ–‡ç« å±•ç¤ºæµ‹è¯•</h1>
            <p>è¿™æ˜¯æ•°æ®åº“ä¸­åº”è¯¥æ˜¾ç¤ºçš„æ–‡ç« å†…å®¹</p>
            <button onclick="loadArticles()">ğŸ”„ åˆ·æ–°æ–‡ç« </button>
            <button onclick="checkConnection()">ğŸ”— æµ‹è¯•è¿æ¥</button>
        </div>

        <div id="status"></div>
        <div id="articles" class="articles-grid">
            <div class="loading">æ­£åœ¨åŠ è½½æ–‡ç« ...</div>
        </div>
    </div>

    <script>
        const supabaseUrl = 'https://talufbfkwrdrpwbzurcu.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRhbHVmYmZrd3JkcnB3Ynp1cmN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNjMxODUsImV4cCI6MjA3ODkzOTE4NX0.tpBu2CSiKJo0Z-YjPcF2Oey8qyhPlinuzJA6Ld8CTo0'

        async function checkConnection() {
            const status = document.getElementById('status')
            try {
                const response = await fetch(`${supabaseUrl}/rest/v1/categories?limit=1`, {
                    headers: {
                        'apikey': supabaseKey,
                        'Authorization': `Bearer ${supabaseKey}`
                    }
                })
                
                if (response.ok) {
                    status.innerHTML = '<div class="success">âœ… Supabaseè¿æ¥æˆåŠŸï¼æ•°æ®åº“å¯ä»¥æ­£å¸¸è®¿é—®ã€‚</div>'
                } else {
                    status.innerHTML = `<div class="error">âŒ è¿æ¥å¤±è´¥: ${response.status}</div>`
                }
            } catch (error) {
                status.innerHTML = `<div class="error">âŒ è¿æ¥å¼‚å¸¸: ${error.message}</div>`
            }
        }

        async function loadArticles() {
            const articlesDiv = document.getElementById('articles')
            const status = document.getElementById('status')
            
            articlesDiv.innerHTML = '<div class="loading">ğŸ”„ æ­£åœ¨åŠ è½½æ–‡ç« ...</div>'
            
            try {
                console.log('ğŸ”„ å¼€å§‹è·å–æ–‡ç« æ•°æ®...')
                
                const response = await fetch(`${supabaseUrl}/rest/v1/articles?select=*,categories(name)&is_published=eq.true&order=created_at.desc&limit=6`, {
                    headers: {
                        'apikey': supabaseKey,
                        'Authorization': `Bearer ${supabaseKey}`,
                        'Accept': 'application/json'
                    }
                })

                console.log('ğŸ“¡ è¯·æ±‚çŠ¶æ€:', response.status)
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`)
                }

                const articles = await response.json()
                console.log('âœ… è·å–åˆ°çš„æ–‡ç« æ•°æ®:', articles)

                if (articles.length === 0) {
                    articlesDiv.innerHTML = `
                        <div class="error">
                            <h3>âš ï¸ æ²¡æœ‰æ‰¾åˆ°æ–‡ç« </h3>
                            <p>æ•°æ®åº“ä¸­æ²¡æœ‰å·²å‘å¸ƒçš„æ–‡ç« ï¼Œæˆ–è€…æŸ¥è¯¢æ¡ä»¶æœ‰é—®é¢˜ã€‚</p>
                        </div>
                    `
                    status.innerHTML = '<div class="error">âŒ æ²¡æœ‰æ‰¾åˆ°æ–‡ç« </div>'
                    return
                }

                // æ˜¾ç¤ºæ–‡ç« 
                articlesDiv.innerHTML = articles.map(article => `
                    <div class="article-card">
                        <div class="article-meta">
                            <span class="category">${article.categories?.name || 'æœªåˆ†ç±»'}</span>
                            <span class="date">${formatDate(article.created_at)}</span>
                        </div>
                        <h3 class="title">${article.title}</h3>
                        <p class="summary">${article.summary || (article.content ? article.content.substring(0, 100) + '...' : 'æš‚æ— æ‘˜è¦')}</p>
                        <div class="views">ğŸ‘ï¸ ${article.view_count || 0} é˜…è¯»</div>
                    </div>
                `).join('')

                status.innerHTML = `<div class="success">âœ… æˆåŠŸåŠ è½½ ${articles.length} ç¯‡æ–‡ç« </div>`
                
            } catch (error) {
                console.error('âŒ åŠ è½½å¤±è´¥:', error)
                articlesDiv.innerHTML = `
                    <div class="error">
                        <h3>âŒ åŠ è½½å¤±è´¥</h3>
                        <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${error.message}</p>
                        <p><strong>å¯èƒ½çš„åŸå› :</strong></p>
                        <ul>
                            <li>ç½‘ç»œè¿æ¥é—®é¢˜</li>
                            <li>SupabaseæœåŠ¡å™¨é”™è¯¯</li>
                            <li>APIå¯†é’¥æ— æ•ˆ</li>
                            <li>CORSæƒé™é—®é¢˜</li>
                        </ul>
                        <button onclick="loadArticles()">é‡è¯•</button>
                    </div>
                `
                status.innerHTML = `<div class="error">âŒ åŠ è½½å¤±è´¥: ${error.message}</div>`
            }
        }

        function formatDate(dateString) {
            if (!dateString) return 'æœªçŸ¥æ—¥æœŸ'
            const date = new Date(dateString)
            return date.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            })
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½æ–‡ç« å’Œæ£€æŸ¥è¿æ¥
        window.onload = function() {
            checkConnection()
            loadArticles()
        }
    </script>
</body>
</html>