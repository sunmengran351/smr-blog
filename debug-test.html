<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .info { background: #f0f8ff; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .success { background: #d4edda; color: #155724; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .error { background: #f8d7da; color: #721c24; padding: 15px; margin: 10px 0; border-radius: 8px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ” åšå®¢æ–‡ç« æ˜¾ç¤ºé—®é¢˜è°ƒè¯•</h1>
    
    <div class="info">
        <h3>ğŸ“‹ è°ƒè¯•æ­¥éª¤</h3>
        <ol>
            <li>æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®</li>
            <li>æµ‹è¯•Supabaseè¿æ¥</li>
            <li>æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯</li>
        </ol>
    </div>

    <button onclick="testConnection()">ğŸ”— æµ‹è¯•Supabaseè¿æ¥</button>
    <button onclick="testArticles()">ğŸ“ æµ‹è¯•è·å–æ–‡ç« </button>
    <button onclick="checkEnvironment()">âš™ï¸ æ£€æŸ¥ç¯å¢ƒå˜é‡</button>

    <div id="results"></div>

    <script type="module">
        import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js'
        
        const results = document.getElementById('results')
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div')
            div.className = `result ${type}`
            div.innerHTML = message
            results.appendChild(div)
            return div
        }
        
        function addDataResult(title, data) {
            const div = document.createElement('div')
            div.className = 'result info'
            div.innerHTML = `<strong>${title}:</strong><pre>${JSON.stringify(data, null, 2)}</pre>`
            results.appendChild(div)
            return div
        }
        
        window.checkEnvironment = function() {
            addResult('ğŸ” æ£€æŸ¥ç¯å¢ƒå˜é‡...', 'info')
            
            const envVars = {
                VITE_SUPABASE_URL: 'https://talufbfkwrdrpwbzurcu.supabase.co',
                VITE_SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRhbHVmYmZrd3JkcnB3Ynp1cmN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNjMxODUsImV4cCI6MjA3ODkzOTE4NX0.tpBu2CSiKJo0Z-YjPcF2Oey8qyhPlinuzJA6Ld8CTo0'
            }
            
            addResult('âœ… ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹', 'success')
            addDataResult('Netlifyç¯å¢ƒå˜é‡é…ç½®', envVars)
            
            addResult(`
                <h3>ğŸ› ï¸ Netlifyè®¾ç½®æ­¥éª¤ï¼š</h3>
                <ol>
                    <li>ç™»å½• <a href="https://app.netlify.com" target="_blank">Netlify</a></li>
                    <li>é€‰æ‹©ä½ çš„åšå®¢ç«™ç‚¹</li>
                    <li>è¿›å…¥ Site settings â†’ Build & deploy â†’ Environment</li>
                    <li>ç‚¹å‡» "Edit variables" æ·»åŠ ç¯å¢ƒå˜é‡</li>
                    <li>æ·»åŠ ä¸Šé¢çš„ä¸¤ä¸ªç¯å¢ƒå˜é‡</li>
                    <li>ä¿å­˜åè§¦å‘é‡æ–°éƒ¨ç½²</li>
                </ol>
            `, 'info')
        }
        
        window.testConnection = async function() {
            addResult('ğŸ”— æµ‹è¯•Supabaseè¿æ¥...', 'info')
            
            try {
                const supabaseUrl = 'https://talufbfkwrdrpwbzurcu.supabase.co'
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRhbHVmYmZrd3JkcnB3Ynp1cmN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNjMxODUsImV4cCI6MjA3ODkzOTE4NX0.tpBu2CSiKJo0Z-YjPcF2Oey8qyhPlinuzJA6Ld8CTo0'
                
                const supabase = createClient(supabaseUrl, supabaseKey)
                addResult('âœ… Supabaseå®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ', 'success')
                
                // æµ‹è¯•è¿æ¥
                const { data, error } = await supabase.from('categories').select('*').limit(1)
                if (error) {
                    addResult(`âŒ è¿æ¥å¤±è´¥: ${error.message}`, 'error')
                    addDataResult('é”™è¯¯è¯¦æƒ…', error)
                } else {
                    addResult('âœ… Supabaseè¿æ¥æˆåŠŸï¼', 'success')
                    addDataResult('æµ‹è¯•æ•°æ®', data)
                }
            } catch (err) {
                addResult(`âŒ è¿æ¥å¼‚å¸¸: ${err.message}`, 'error')
                addDataResult('å¼‚å¸¸è¯¦æƒ…', err)
            }
        }
        
        window.testArticles = async function() {
            addResult('ğŸ“ æµ‹è¯•è·å–æ–‡ç« ...', 'info')
            
            try {
                const supabaseUrl = 'https://talufbfkwrdrpwbzurcu.supabase.co'
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRhbHVmYmZrd3JkcnB3Ynp1cmN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNjMxODUsImV4cCI6MjA3ODkzOTE4NX0.tpBu2CSiKJo0Z-YjPcF2Oey8qyhPlinuzJA6Ld8CTo0'
                
                const supabase = createClient(supabaseUrl, supabaseKey)
                
                const { data, error, count } = await supabase
                    .from('articles')
                    .select(`
                        *,
                        categories(name)
                    `, { count: 'exact' })
                    .eq('is_published', true)
                    .order('created_at', { ascending: false })
                    .limit(3)
                
                if (error) {
                    addResult(`âŒ è·å–æ–‡ç« å¤±è´¥: ${error.message}`, 'error')
                    addDataResult('é”™è¯¯è¯¦æƒ…', error)
                } else {
                    addResult(`âœ… æˆåŠŸè·å– ${count} ç¯‡æ–‡ç« ï¼`, 'success')
                    addDataResult('æ–‡ç« æ•°æ®', data)
                    
                    // æ˜¾ç¤ºæ–‡ç« é¢„è§ˆ
                    data.forEach((article, index) => {
                        addResult(`
                            <h4>ğŸ“„ æ–‡ç«  ${index + 1}</h4>
                            <p><strong>æ ‡é¢˜:</strong> ${article.title}</p>
                            <p><strong>åˆ†ç±»:</strong> ${article.categories?.name || 'æœªåˆ†ç±»'}</p>
                            <p><strong>æ‘˜è¦:</strong> ${article.summary || article.content?.substring(0, 100) + '...'}</p>
                            <p><strong>åˆ›å»ºæ—¶é—´:</strong> ${article.created_at}</p>
                            <hr>
                        `, 'success')
                    })
                }
            } catch (err) {
                addResult(`âŒ è·å–æ–‡ç« å¼‚å¸¸: ${err.message}`, 'error')
                addDataResult('å¼‚å¸¸è¯¦æƒ…', err)
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒå˜é‡
        setTimeout(checkEnvironment, 1000)
    </script>
</body>
</html>